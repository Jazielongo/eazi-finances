<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Eazi Finances</title>

    <!-- Bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />

    <!-- CSS local -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Pacifico&display=swap"
        rel="stylesheet" />

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='img/eaziLogo500.png') }}" type="image/png" />
</head>

<body>
    <!-- Navbar -->
    {% include 'partials/navbar.html' %}

    <!-- Dashboard Content -->
    <section class="dashboard-section">
        <div class="container">
            <!-- Balance General -->
            <div class="balance-card">
                <div class="balance-header">
                    <h2 class="balance-title">BALANCE GENERAL</h2>
                </div>
                <div class="balance-content">
                    <div class="balance-info">
                        <div class="balance-amount" id="balanceAmount">
                            <span class="amount-value">{{ "{:,.2f}".format(balance) }}</span>
                            <span class="amount-currency">MXN</span>
                        </div>
                        <div class="balance-company">EMPRESA S.A. DE C.V.</div>
                    </div>
                    <div class="balance-coin">
                        <div class="finni-character">
                            <img src="{{ url_for('static', filename='img/Finni1.png') }}" alt="Finni"
                                class="finni-image" id="finniImage" />
                            <div class="balance-toggle" id="balanceToggle">
                                <img src="{{ url_for('static', filename='img/ocultar.svg') }}" alt="Ocultar balance"
                                    class="eye-icon" id="eyeIcon" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <div class="action-button">
                    <span class="action-label">REALIZAR REGISTRO</span>
                    <div class="action-icon">
                        <img src="{{ url_for('static', filename='img/ganancia.png') }}" alt="Realizar Registro"
                            class="action-icon-img" />
                    </div>
                </div>

                <div class="action-button">
                    <span class="action-label">REPORTES</span>
                    <div class="action-icon">
                        <img src="{{ url_for('static', filename='img/nota.png') }}" alt="Reportes"
                            class="action-icon-img" />
                    </div>
                </div>

                <div class="action-button">
                    <span class="action-label">ESCANEAR TICKETS</span>
                    <div class="action-icon">
                        <img src="{{ url_for('static', filename='img/proyecto-de-ley.png') }}" alt="Escanear Tickets"
                            class="action-icon-img" />
                    </div>
                </div>

                <div class="action-button">
                    <span class="action-label">MIS TICKETS</span>
                    <div class="action-icon">
                        <img src="{{ url_for('static', filename='img/tienda.png') }}" alt="Mis Tickets"
                            class="action-icon-img" />
                    </div>
                </div>
            </div>

            <!-- MOVIMIENTOS SECCION -->
            <div class="movements-section">
                <h2 class="movements-title">MOVIMIENTOS</h2>

                <div class="movements-container">
                    <!-- Ingresos Card -->
                    <div class="movement-card">
                        <div class="movement-header ingresos-header">
                            <div class="menu-icon" id="filtersToggle">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white"
                                    stroke-width="2">
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <line x1="3" y1="12" x2="21" y2="12"></line>
                                    <line x1="3" y1="18" x2="21" y2="18"></line>
                                </svg>
                            </div>
                            <h3 class="movement-title">INGRESOS</h3>

                            <!-- Filtros Dropdown -->
                            <div class="filters-dropdown" id="filtersDropdown">
                                <div class="filters-header">
                                    <h4>FILTROS DE B√öSQUEDA</h4>
                                </div>
                                <div class="filters-options">
                                    <button class="filter-button" data-filter="fecha" id="fechaButton">
                                        <img src="{{ url_for('static', filename='img/7.png') }}" alt="Fecha"
                                            class="filter-icon">
                                        FECHA
                                    </button>
                                    <button class="filter-button" data-filter="monto">
                                        <img src="{{ url_for('static', filename='img/6.png') }}" alt="Monto"
                                            class="filter-icon">
                                        MONTO
                                    </button>
                                    <button class="filter-button" data-filter="descripcion">
                                        <img src="{{ url_for('static', filename='img/5.png') }}" alt="Descripci√≥n"
                                            class="filter-icon">
                                        DESCRIPCI√ìN
                                    </button>
                                </div>
                            </div>

                            <!-- Calendario Dropdown -->
                            <div class="calendar-dropdown" id="calendarDropdown">
                                <div class="calendar-header">
                                    <button class="calendar-nav" id="prevYear">‚Äπ‚Äπ</button>
                                    <button class="calendar-nav" id="prevMonth">‚Äπ</button>
                                    <h4 id="currentMonth"></h4>
                                    <button class="calendar-nav" id="nextMonth">‚Ä∫</button>
                                    <button class="calendar-nav" id="nextYear">‚Ä∫‚Ä∫</button>
                                </div>
                                <div class="calendar-grid" id="calendarGrid">
                                    <!-- Los d√≠as se generar√°n din√°micamente con JavaScript -->
                                </div>
                                <div class="calendar-actions">
                                    <button class="calendar-btn calendar-btn-secondary"
                                        id="cancelDate">Cancelar</button>
                                    <button class="calendar-btn calendar-btn-primary" id="searchDate">Buscar</button>
                                </div>
                            </div>

                            <!-- Monto Dropdown -->
                            <div class="monto-dropdown" id="montoDropdown">
                                <div class="monto-header">
                                    <h4>RANGOS DE MONTO</h4>
                                </div>
                                <div class="monto-options">
                                    <button class="monto-option" data-range="0-99">$0 - $99</button>
                                    <button class="monto-option" data-range="100-199">$100 - $199</button>
                                    <button class="monto-option" data-range="200-499">$200 - $499</button>
                                    <button class="monto-option" data-range="500-999">$500 - $999</button>
                                    <button class="monto-option" data-range="1000-1999">$1,000 - $1,999</button>
                                    <button class="monto-option" data-range="2000-4999">$2,000 - $4,999</button>
                                    <button class="monto-option" data-range="5000-9999">$5,000 - $9,999</button>
                                    <button class="monto-option" data-range="10000+">$10,000+</button>
                                </div>
                                <div class="monto-actions">
                                    <button class="monto-btn monto-btn-secondary" id="cancelMonto">Cancelar</button>
                                    <button class="monto-btn monto-btn-primary" id="searchMonto">Buscar</button>
                                </div>
                            </div>

                            <!-- Descripci√≥n Dropdown -->
                            <div class="descripcion-dropdown" id="descripcionDropdown">
                                <div class="descripcion-header">
                                    <h4>FILTRO POR DESCRIPCI√ìN</h4>
                                </div>
                                <div class="descripcion-content">
                                    <div class="descripcion-search">
                                        <input type="text" id="descripcionInput"
                                            placeholder="Escribe tu b√∫squeda personalizada..."
                                            class="descripcion-input">
                                    </div>
                                    <div class="descripcion-options">
                                        <button class="descripcion-option" data-descripcion="venta">Venta</button>
                                        <button class="descripcion-option" data-descripcion="compra">Compra</button>
                                        <button class="descripcion-option" data-descripcion="servicio">Servicio</button>
                                        <button class="descripcion-option" data-descripcion="producto">Producto</button>
                                        <button class="descripcion-option" data-descripcion="pago">Pago</button>
                                        <button class="descripcion-option"
                                            data-descripcion="reembolso">Reembolso</button>
                                        <button class="descripcion-option"
                                            data-descripcion="transferencia">Transferencia</button>
                                        <button class="descripcion-option" data-descripcion="comision">Comisi√≥n</button>
                                    </div>
                                </div>
                                <div class="descripcion-actions">
                                    <button class="descripcion-btn descripcion-btn-secondary"
                                        id="cancelDescripcion">Cancelar</button>
                                    <button class="descripcion-btn descripcion-btn-primary"
                                        id="searchDescripcion">Buscar</button>
                                </div>
                            </div>
                        </div>
                        <div class="movement-content">
                            {% if ingresos %}
                                {% for ingreso in ingresos %}
                                <div class="movement-item">
                                    <div class="movement-info">
                                        <div class="movement-description">{{ ingreso.descripcion }}</div>
                                        <div class="movement-date">{{ ingreso.fecha }}</div>
                                    </div>
                                    <div class="movement-amount positive">+${{ "{:,.2f}".format(ingreso.total) }}</div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="movement-item">
                                    <div class="movement-info">
                                        <div class="movement-description">No hay ingresos registrados</div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Egresos Card -->
                    <div class="movement-card">
                        <div class="movement-header egresos-header">
                            <div class="menu-icon" id="egresosFiltersToggle">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white"
                                    stroke-width="2">
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <line x1="3" y1="12" x2="21" y2="12"></line>
                                    <line x1="3" y1="18" x2="21" y2="18"></line>
                                </svg>
                            </div>
                            <h3 class="movement-title">EGRESOS</h3>

                            <!-- Filtros Dropdown -->
                            <div class="filters-dropdown" id="egresosFiltersDropdown">
                                <div class="filters-header">
                                    <h4>FILTROS DE B√öSQUEDA</h4>
                                </div>
                                <div class="filters-options">
                                    <button class="filter-button" data-filter="fecha" id="egresosFechaButton">
                                        <img src="{{ url_for('static', filename='img/7.png') }}" alt="Fecha"
                                            class="filter-icon">
                                        FECHA
                                    </button>
                                    <button class="filter-button" data-filter="monto">
                                        <img src="{{ url_for('static', filename='img/6.png') }}" alt="Monto"
                                            class="filter-icon">
                                        MONTO
                                    </button>
                                    <button class="filter-button" data-filter="descripcion">
                                        <img src="{{ url_for('static', filename='img/5.png') }}" alt="Descripci√≥n"
                                            class="filter-icon">
                                        DESCRIPCI√ìN
                                    </button>
                                </div>
                            </div>

                            <!-- Calendario Dropdown -->
                            <div class="calendar-dropdown" id="egresosCalendarDropdown">
                                <div class="calendar-header">
                                    <button class="calendar-nav" id="egresosPrevYear">‚Äπ‚Äπ</button>
                                    <button class="calendar-nav" id="egresosPrevMonth">‚Äπ</button>
                                    <h4 id="egresosCurrentMonth"></h4>
                                    <button class="calendar-nav" id="egresosNextMonth">‚Ä∫</button>
                                    <button class="calendar-nav" id="egresosNextYear">‚Ä∫‚Ä∫</button>
                                </div>
                                <div class="calendar-grid" id="egresosCalendarGrid">
                                    <!-- Los d√≠as se generar√°n din√°micamente con JavaScript -->
                                </div>
                                <div class="calendar-actions">
                                    <button class="calendar-btn calendar-btn-secondary"
                                        id="egresosCancelDate">Cancelar</button>
                                    <button class="calendar-btn calendar-btn-primary"
                                        id="egresosSearchDate">Buscar</button>
                                </div>
                            </div>

                            <!-- Monto Dropdown -->
                            <div class="monto-dropdown" id="egresosMontoDropdown">
                                <div class="monto-header">
                                    <h4>RANGOS DE MONTO</h4>
                                </div>
                                <div class="monto-options">
                                    <button class="monto-option" data-range="0-99">$0 - $99</button>
                                    <button class="monto-option" data-range="100-199">$100 - $199</button>
                                    <button class="monto-option" data-range="200-499">$200 - $499</button>
                                    <button class="monto-option" data-range="500-999">$500 - $999</button>
                                    <button class="monto-option" data-range="1000-1999">$1,000 - $1,999</button>
                                    <button class="monto-option" data-range="2000-4999">$2,000 - $4,999</button>
                                    <button class="monto-option" data-range="5000-9999">$5,000 - $9,999</button>
                                    <button class="monto-option" data-range="10000+">$10,000+</button>
                                </div>
                                <div class="monto-actions">
                                    <button class="monto-btn monto-btn-secondary"
                                        id="egresosCancelMonto">Cancelar</button>
                                    <button class="monto-btn monto-btn-primary" id="egresosSearchMonto">Buscar</button>
                                </div>
                            </div>

                            <!-- Descripci√≥n Dropdown -->
                            <div class="descripcion-dropdown" id="egresosDescripcionDropdown">
                                <div class="descripcion-header">
                                    <h4>FILTRO POR DESCRIPCI√ìN</h4>
                                </div>
                                <div class="descripcion-content">
                                    <div class="descripcion-search">
                                        <input type="text" id="egresosDescripcionInput"
                                            placeholder="Escribe tu b√∫squeda personalizada..."
                                            class="descripcion-input">
                                    </div>
                                    <div class="descripcion-options">
                                        <button class="descripcion-option" data-descripcion="venta">Venta</button>
                                        <button class="descripcion-option" data-descripcion="compra">Compra</button>
                                        <button class="descripcion-option" data-descripcion="servicio">Servicio</button>
                                        <button class="descripcion-option" data-descripcion="producto">Producto</button>
                                        <button class="descripcion-option" data-descripcion="pago">Pago</button>
                                        <button class="descripcion-option"
                                            data-descripcion="reembolso">Reembolso</button>
                                        <button class="descripcion-option"
                                            data-descripcion="transferencia">Transferencia</button>
                                        <button class="descripcion-option" data-descripcion="comision">Comisi√≥n</button>
                                    </div>
                                </div>
                                <div class="descripcion-actions">
                                    <button class="descripcion-btn descripcion-btn-secondary"
                                        id="egresosCancelDescripcion">Cancelar</button>
                                    <button class="descripcion-btn descripcion-btn-primary"
                                        id="egresosSearchDescripcion">Buscar</button>
                                </div>
                            </div>
                        </div>
                        <div class="movement-content">
                            {% if egresos %}
                                {% for egreso in egresos %}
                                <div class="movement-item">
                                    <div class="movement-info">
                                        <div class="movement-description">{{ egreso.descripcion }}</div>
                                        <div class="movement-date">{{ egreso.fecha }}</div>
                                    </div>
                                    <div class="movement-amount negative">-${{ "{:,.2f}".format(egreso.total) }}</div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="movement-item">
                                    <div class="movement-info">
                                        <div class="movement-description">No hay egresos registrados</div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="nosotros" class="footer">
        <div class="container">
            <div class="columns">
                <div class="column">
                    <h3 class="footer-title">DevTeam</h3>
                    <ul class="footer-list">
                        <li class="footer-item" data-modal="devteam">Ver equipo</li>
                    </ul>
                </div>
                <div class="column">
                    <h3 class="footer-title">Nuestra meta</h3>
                    <ul class="footer-list">
                        <li class="footer-item" data-modal="mision">Misi√≥n</li>
                        <li class="footer-item" data-modal="vision">Visi√≥n</li>
                    </ul>
                </div>
                <div class="column">
                    <h3 class="footer-title">Podemos ayudarte</h3>
                    <ul class="footer-list">
                        <li class="footer-item" data-modal="faq">Preguntas frecuentes</li>
                        <li class="footer-item" data-modal="contact">Env√≠anos un correo</li>
                    </ul>
                </div>
                <div class="column">
                    <h3 class="footer-title">S√≠guenos</h3>
                    <ul class="footer-list">
                        <li class="footer-item" data-modal="facebook">Facebook</li>
                        <li class="footer-item" data-modal="instagram">Instagram</li>
                        <li class="footer-item" data-modal="tiktok">TikTok</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modales (reutilizados del index.html) -->
    <!-- Modal DevTeam -->
    <div id="devteamModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Nuestro Equipo de Desarrollo</h2>
            <div class="team-grid">
                <div class="team-member">
                    <div class="member-photo">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#2F851D" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h3>Jaziel Ambriz</h3>
                    <p class="member-role">Project Manager</p>
                    <p class="member-bio">L√≠der de proyecto con experiencia en metodolog√≠as √°giles y coordinaci√≥n de
                        equipos de
                        desarrollo.</p>
                </div>
                <div class="team-member">
                    <div class="member-photo">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#2F851D" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h3>Madeline Quintana</h3>
                    <p class="member-role">Dise√±adora UX/UI</p>
                    <p class="member-bio">Creativa especializada en dise√±o de interfaces y experiencia de usuario,
                        enfocada en
                        soluciones intuitivas.</p>
                </div>
                <div class="team-member">
                    <div class="member-photo">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#2F851D" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h3>Enrique J. D√≠az</h3>
                    <p class="member-role">Desarrollador Backend</p>
                    <p class="member-bio">Experto en arquitectura de servidores y bases de datos, con enfoque en
                        seguridad y
                        rendimiento.</p>
                </div>
                <div class="team-member">
                    <div class="member-photo">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#2F851D" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h3>Jes√∫s E. Go√±i</h3>
                    <p class="member-role">Desarrollador Frontend</p>
                    <p class="member-bio">Experto en desarrollo web con experiencia en tecnolog√≠as modernas y
                        arquitecturas
                        escalables.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Misi√≥n -->
    <div id="misionModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Nuestra Misi√≥n</h2>
            <div class="mission-content">
                <p>En Eazi Finances queremos que manejar tu dinero sea f√°cil y sin estr√©s. Ayudamos a j√≥venes
                    emprendedores a
                    organizar sus finanzas para que puedan enfocarse en so√±ar en grande y hacer crecer sus proyectos con
                    confianza.</p>
            </div>
        </div>
    </div>

    <!-- Modal Visi√≥n -->
    <div id="visionModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Nuestra Visi√≥n</h2>
            <div class="vision-content">
                <p>So√±amos con un mundo donde cada joven emprendedor tenga las herramientas y la seguridad para
                    transformar sus
                    ideas en negocios incre√≠bles, disfrutando el camino y celebrando cada logro.</p>
            </div>
        </div>
    </div>

    <!-- Modal FAQ -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Preguntas Frecuentes</h2>
            <div class="faq-content">
                <p>Esta secci√≥n estar√° disponible pr√≥ximamente con las preguntas m√°s frecuentes de nuestros usuarios.
                </p>
                <p>Mientras tanto, puedes contactarnos directamente a trav√©s del formulario de contacto.</p>
            </div>
        </div>
    </div>

    <!-- Modal Contacto -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Cont√°ctanos</h2>
            <div class="contact-content">
                <p>¬øTienes alguna pregunta o necesitas ayuda? Estamos aqu√≠ para asistirte.</p>
                <div class="contact-form">
                    <form>
                        <div class="form-group">
                            <label for="contactName">Nombre:</label>
                            <input type="text" id="contactName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="contactEmail">Correo electr√≥nico:</label>
                            <input type="email" id="contactEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="contactMessage">Mensaje:</label>
                            <textarea id="contactMessage" name="message" rows="4" required></textarea>
                        </div>
                        <button type="submit" class="submit-btn">Enviar Mensaje</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Redes Sociales -->
    <div id="facebookModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Facebook</h2>
            <div class="social-content">
                <p>S√≠guenos en Facebook para estar al d√≠a con nuestras √∫ltimas actualizaciones y noticias.</p>
                <p>Pr√≥ximamente: Enlace directo a nuestra p√°gina de Facebook.</p>
            </div>
        </div>
    </div>

    <div id="instagramModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Instagram</h2>
            <div class="social-content">
                <p>S√≠guenos en Instagram para contenido visual y tips financieros.</p>
                <p>Pr√≥ximamente: Enlace directo a nuestro perfil de Instagram.</p>
            </div>
        </div>
    </div>

    <div id="tiktokModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>TikTok</h2>
            <div class="social-content">
                <p>S√≠guenos en TikTok para contenido educativo y entretenido sobre finanzas.</p>
                <p>Pr√≥ximamente: Enlace directo a nuestro perfil de TikTok.</p>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Script para modales del footer
        document.addEventListener('DOMContentLoaded', function () {
            // Esperar un poco para asegurar que todo est√© cargado
            setTimeout(function () {
                // Buscar elementos del footer
                const footerItems = document.querySelectorAll('.footer-item');
                const modals = document.querySelectorAll('.modal');

                // Agregar event listeners a cada elemento del footer
                footerItems.forEach(function (item) {
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();

                        const modalId = item.getAttribute('data-modal');

                        if (modalId) {
                            const modal = document.getElementById(modalId + 'Modal');

                            if (modal) {
                                modal.style.display = 'block';
                                document.body.style.overflow = 'hidden';
                            }
                        }
                    });
                });

                // Agregar event listeners para cerrar modales
                const closeButtons = document.querySelectorAll('.close');

                closeButtons.forEach(function (button) {
                    button.addEventListener('click', function () {
                        const modal = button.closest('.modal');
                        if (modal) {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        }
                    });
                });

                // Cerrar modales al hacer click fuera
                modals.forEach(function (modal) {
                    modal.addEventListener('click', function (e) {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        }
                    });
                });

                // Cerrar con tecla Escape
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        modals.forEach(function (modal) {
                            if (modal.style.display === 'block') {
                                modal.style.display = 'none';
                                document.body.style.overflow = 'auto';
                            }
                        });
                    }
                });

                // User dropdown functionality
                const userIcon = document.getElementById('userIcon');
                const userDropdown = document.getElementById('userDropdown');

                if (userIcon && userDropdown) {
                    userIcon.addEventListener('click', function (e) {
                        e.stopPropagation();
                        userDropdown.classList.toggle('show');
                    });

                    // Cerrar dropdown al hacer click fuera
                    document.addEventListener('click', function () {
                        userDropdown.classList.remove('show');
                    });

                    // Prevenir que se cierre al hacer click dentro del dropdown
                    userDropdown.addEventListener('click', function (e) {
                        e.stopPropagation();
                    });
                }

                // Logout functionality
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function () {
                        fetch('/logout', { method: 'POST' })
                            .then(r => r.json())
                            .then(data => {
                                if (data.success) {
                                    alert(data.message);
                                    if (data.redirect) {
                                        window.location.href = data.redirect;
                                    }
                                } else {
                                    alert('Error al cerrar sesi√≥n.');
                                }
                            })
                            .catch(() => {
                                alert('Error de conexi√≥n.');
                            });
                    });
                }

                // Action buttons functionality
                const actionButtons = document.querySelectorAll('.action-button');

                actionButtons.forEach((button, index) => {
                    button.addEventListener('click', function () {
                        const routes = [
                            '/realizar-registro',
                            '/edicion',
                            '/escanear-tickets',
                            '/mis-tickets'
                        ];

                        if (routes[index]) {
                            window.location.href = routes[index];
                        }
                    });
                });

                // Filters dropdown functionality
                const filtersToggle = document.getElementById('filtersToggle');
                const filtersDropdown = document.getElementById('filtersDropdown');
                let isFiltersOpen = false;

                if (filtersToggle && filtersDropdown) {
                    filtersToggle.addEventListener('click', function (e) {
                        e.stopPropagation();

                        if (isFiltersOpen) {
                            // Cerrar men√∫
                            gsap.to(filtersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    filtersDropdown.style.display = 'none';
                                }
                            });
                            isFiltersOpen = false;
                        } else {
                            // Abrir men√∫
                            filtersDropdown.style.display = 'block';
                            gsap.fromTo(filtersDropdown,
                                { opacity: 0, scale: 0.95, y: -10 },
                                {
                                    duration: 0.3,
                                    opacity: 1,
                                    scale: 1,
                                    y: 0,
                                    ease: "power2.out"
                                }
                            );
                            isFiltersOpen = true;
                        }
                    });

                    // Cerrar men√∫ al hacer click fuera
                    document.addEventListener('click', function (e) {
                        if (isFiltersOpen && !filtersDropdown.contains(e.target) && !filtersToggle.contains(e.target)) {
                            gsap.to(filtersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    filtersDropdown.style.display = 'none';
                                }
                            });
                            isFiltersOpen = false;
                        }
                    });

                    // Manejar clicks en los botones de filtro de INGRESOS
                    const filterButtons = document.querySelectorAll('#filtersDropdown .filter-button');
                    filterButtons.forEach(button => {
                        button.addEventListener('click', function (e) {
                            e.stopPropagation();
                            const filterType = this.getAttribute('data-filter');

                            if (filterType === 'fecha') {
                                // Mostrar calendario en lugar de cerrar el men√∫
                                showCalendar();
                            } else if (filterType === 'monto') {
                                // Mostrar dropdown de montos
                                showMonto();
                            } else if (filterType === 'descripcion') {
                                // Mostrar dropdown de descripci√≥n
                                showDescripcion();
                            } else {
                                // Aqu√≠ puedes agregar la l√≥gica de filtrado para otros filtros
                                console.log('Filtro seleccionado:', filterType);

                                // Cerrar el men√∫ despu√©s de seleccionar
                                gsap.to(filtersDropdown, {
                                    duration: 0.3,
                                    opacity: 0,
                                    scale: 0.95,
                                    y: -10,
                                    ease: "power2.inOut",
                                    onComplete: function () {
                                        filtersDropdown.style.display = 'none';
                                    }
                                });
                                isFiltersOpen = false;
                            }
                        });
                    });
                }

                // Egresos filters dropdown functionality
                const egresosFiltersToggle = document.getElementById('egresosFiltersToggle');
                const egresosFiltersDropdown = document.getElementById('egresosFiltersDropdown');

                if (egresosFiltersToggle && egresosFiltersDropdown) {
                    egresosFiltersToggle.addEventListener('click', function (e) {
                        e.stopPropagation();

                        if (isEgresosFiltersOpen) {
                            // Cerrar men√∫
                            gsap.to(egresosFiltersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosFiltersDropdown.style.display = 'none';
                                }
                            });
                            isEgresosFiltersOpen = false;
                        } else {
                            // Abrir men√∫
                            egresosFiltersDropdown.style.display = 'block';
                            gsap.fromTo(egresosFiltersDropdown,
                                { opacity: 0, scale: 0.95, y: -10 },
                                {
                                    duration: 0.3,
                                    opacity: 1,
                                    scale: 1,
                                    y: 0,
                                    ease: "power2.out"
                                }
                            );
                            isEgresosFiltersOpen = true;
                        }
                    });

                    // Cerrar men√∫ de egresos al hacer click fuera
                    document.addEventListener('click', function (e) {
                        if (isEgresosFiltersOpen && !egresosFiltersDropdown.contains(e.target) && !egresosFiltersToggle.contains(e.target)) {
                            gsap.to(egresosFiltersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosFiltersDropdown.style.display = 'none';
                                }
                            });
                            isEgresosFiltersOpen = false;
                        }
                    });
                }

                // Egresos Calendar functionality
                function showEgresosCalendar() {
                    console.log('üìÖ Mostrando calendario de egresos...');

                    const egresosCalendarDropdown = document.getElementById('egresosCalendarDropdown');

                    if (egresosCalendarDropdown) {
                        console.log('‚úÖ Calendario de egresos encontrado');

                        // Cerrar men√∫ de filtros de egresos
                        const egresosFiltersDropdown = document.getElementById('egresosFiltersDropdown');
                        if (egresosFiltersDropdown) {
                            gsap.to(egresosFiltersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosFiltersDropdown.style.display = 'none';
                                }
                            });
                            isEgresosFiltersOpen = false;
                        }

                        // Mostrar calendario de egresos
                        egresosCalendarDropdown.style.display = 'block';
                        console.log('üìÖ Calendario de egresos mostrado');

                        gsap.fromTo(egresosCalendarDropdown,
                            { opacity: 0, scale: 0.95, y: -10 },
                            {
                                duration: 0.3,
                                opacity: 1,
                                scale: 1,
                                y: 0,
                                ease: "power2.out"
                            }
                        );
                        isEgresosCalendarOpen = true;
                        console.log('‚úÖ Calendario de egresos completamente mostrado');

                        // Generar calendario de egresos
                        generateEgresosCalendar();
                    } else {
                        console.error('‚ùå Calendario de egresos no encontrado');
                    }
                }

                function generateEgresosCalendar() {
                    const egresosCurrentMonthElement = document.getElementById('egresosCurrentMonth');
                    const egresosCalendarGrid = document.getElementById('egresosCalendarGrid');

                    if (!egresosCurrentMonthElement || !egresosCalendarGrid) {
                        console.error('‚ùå Elementos del calendario de egresos no encontrados');
                        return;
                    }

                    const year = egresosCurrentDate.getFullYear();
                    const month = egresosCurrentDate.getMonth();

                    // Actualizar t√≠tulo del mes
                    const monthNames = [
                        'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                        'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                    ];
                    egresosCurrentMonthElement.textContent = `${monthNames[month]} ${year}`;

                    // Limpiar grid
                    egresosCalendarGrid.innerHTML = '';

                    // D√≠as de la semana
                    const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
                    dayHeaders.forEach(day => {
                        const dayHeader = document.createElement('div');
                        dayHeader.className = 'calendar-day-header';
                        dayHeader.textContent = day;
                        egresosCalendarGrid.appendChild(dayHeader);
                    });

                    // Primer d√≠a del mes
                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const startDate = new Date(firstDay);
                    startDate.setDate(startDate.getDate() - firstDay.getDay());

                    // Generar d√≠as
                    for (let i = 0; i < 42; i++) {
                        const currentDay = new Date(startDate);
                        currentDay.setDate(startDate.getDate() + i);

                        const dayButton = document.createElement('button');
                        dayButton.className = 'calendar-day';
                        dayButton.textContent = currentDay.getDate();

                        // Marcar d√≠as del mes actual
                        if (currentDay.getMonth() === month) {
                            dayButton.classList.add('current-month');
                        } else {
                            dayButton.classList.add('other-month');
                        }

                        // Marcar d√≠a seleccionado
                        if (egresosSelectedDate &&
                            currentDay.getDate() === egresosSelectedDate.getDate() &&
                            currentDay.getMonth() === egresosSelectedDate.getMonth() &&
                            currentDay.getFullYear() === egresosSelectedDate.getFullYear()) {
                            dayButton.classList.add('selected');
                        }

                        egresosCalendarGrid.appendChild(dayButton);

                        // Event listener para selecci√≥n de d√≠a
                        dayButton.addEventListener('click', function () {
                            console.log('üìÖ Click en d√≠a del calendario de egresos:', currentDay.getDate());

                            // Remover selecci√≥n anterior
                            document.querySelectorAll('#egresosCalendarGrid .calendar-day.selected').forEach(day => {
                                day.classList.remove('selected');
                            });

                            // Agregar selecci√≥n actual
                            this.classList.add('selected');
                            egresosSelectedDate = new Date(year, month, currentDay.getDate());

                            console.log('üìÖ Fecha de egresos seleccionada:', egresosSelectedDate);
                            console.log('üìÖ Fecha formateada:', egresosSelectedDate.toLocaleDateString('es-ES'));
                            updateEgresosCalendarButtonStates();
                        });
                    }

                    updateEgresosCalendarButtonStates();
                }

                function updateEgresosCalendarButtonStates() {
                    console.log('üîÑ Actualizando estado de botones del calendario de egresos...');
                    const searchEgresosBtn = document.getElementById('egresosSearchDate');
                    const cancelEgresosBtn = document.getElementById('egresosCancelDate');

                    console.log('üîç Bot√≥n buscar egresos encontrado:', !!searchEgresosBtn);
                    console.log('üîç Bot√≥n cancelar egresos encontrado:', !!cancelEgresosBtn);
                    console.log('üìÖ Fecha seleccionada en egresos:', egresosSelectedDate);

                    if (searchEgresosBtn) {
                        if (egresosSelectedDate) {
                            searchEgresosBtn.textContent = `Buscar (${egresosSelectedDate.toLocaleDateString('es-ES')})`;
                            searchEgresosBtn.disabled = false;
                            console.log('‚úÖ Bot√≥n buscar egresos actualizado con fecha:', egresosSelectedDate.toLocaleDateString('es-ES'));
                        } else {
                            searchEgresosBtn.textContent = 'Buscar';
                            searchEgresosBtn.disabled = false;
                            console.log('‚ö†Ô∏è Bot√≥n buscar egresos sin fecha');
                        }
                    } else {
                        console.error('‚ùå Bot√≥n buscar egresos no encontrado');
                    }

                    if (cancelEgresosBtn) {
                        cancelEgresosBtn.textContent = 'Cancelar';
                        cancelEgresosBtn.disabled = false;
                        console.log('‚úÖ Bot√≥n cancelar egresos actualizado');
                    } else {
                        console.error('‚ùå Bot√≥n cancelar egresos no encontrado');
                    }
                }

                // Egresos calendar navigation buttons functionality (direct event listeners)
                const egresosPrevYearBtn = document.getElementById('egresosPrevYear');
                const egresosNextYearBtn = document.getElementById('egresosNextYear');
                const egresosPrevMonthBtn = document.getElementById('egresosPrevMonth');
                const egresosNextMonthBtn = document.getElementById('egresosNextMonth');

                if (egresosPrevYearBtn) {
                    egresosPrevYearBtn.addEventListener('click', function (e) {
                        console.log('üìÖ Click en bot√≥n a√±o anterior de egresos detectado');
                        e.stopPropagation();
                        egresosCurrentDate.setFullYear(egresosCurrentDate.getFullYear() - 1);
                        generateEgresosCalendar();
                        updateEgresosCalendarButtonStates();
                    });
                }

                if (egresosNextYearBtn) {
                    egresosNextYearBtn.addEventListener('click', function (e) {
                        console.log('üìÖ Click en bot√≥n a√±o siguiente de egresos detectado');
                        e.stopPropagation();
                        egresosCurrentDate.setFullYear(egresosCurrentDate.getFullYear() + 1);
                        generateEgresosCalendar();
                        updateEgresosCalendarButtonStates();
                    });
                }

                if (egresosPrevMonthBtn) {
                    egresosPrevMonthBtn.addEventListener('click', function (e) {
                        console.log('üìÖ Click en bot√≥n mes anterior de egresos detectado');
                        e.stopPropagation();
                        egresosCurrentDate.setMonth(egresosCurrentDate.getMonth() - 1);
                        generateEgresosCalendar();
                        updateEgresosCalendarButtonStates();
                    });
                }

                if (egresosNextMonthBtn) {
                    egresosNextMonthBtn.addEventListener('click', function (e) {
                        console.log('üìÖ Click en bot√≥n mes siguiente de egresos detectado');
                        e.stopPropagation();
                        egresosCurrentDate.setMonth(egresosCurrentDate.getMonth() + 1);
                        generateEgresosCalendar();
                        updateEgresosCalendarButtonStates();
                    });
                }

                // Egresos filter buttons functionality
                const egresosFilterButtons = document.querySelectorAll('#egresosFiltersDropdown .filter-button');
                egresosFilterButtons.forEach(button => {
                    button.addEventListener('click', function (e) {
                        e.stopPropagation();
                        const filterType = this.getAttribute('data-filter');

                        if (filterType === 'fecha') {
                            showEgresosCalendar();
                        } else if (filterType === 'monto') {
                            showEgresosMonto();
                        } else if (filterType === 'descripcion') {
                            showEgresosDescripcion();
                        }
                    });
                });

                // Egresos calendar buttons functionality (direct event listeners)
                const egresosCancelBtn = document.getElementById('egresosCancelDate');
                const egresosSearchBtn = document.getElementById('egresosSearchDate');

                if (egresosCancelBtn) {
                    egresosCancelBtn.addEventListener('click', function (e) {
                        console.log('üîç Click en bot√≥n cancelar egresos detectado');
                        e.stopPropagation();

                        const egresosCalendarDropdown = document.getElementById('egresosCalendarDropdown');
                        if (egresosCalendarDropdown) {
                            gsap.to(egresosCalendarDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosCalendarDropdown.style.display = 'none';
                                }
                            });
                            isEgresosCalendarOpen = false;
                        }
                    });
                }

                if (egresosSearchBtn) {
                    egresosSearchBtn.addEventListener('click', function (e) {
                        console.log('üîç Click en bot√≥n buscar egresos detectado (direct listener)');
                        console.log('üìÖ Fecha seleccionada en egresos:', egresosSelectedDate);
                        e.stopPropagation();

                        if (egresosSelectedDate) {
                            console.log('‚úÖ Fecha v√°lida encontrada, procediendo con b√∫squeda...');
                            console.log('üîç B√∫squeda por fecha de egresos:', egresosSelectedDate);

                            // Mostrar feedback visual "Buscando..."
                            const originalText = this.textContent;
                            this.textContent = '‚úì Buscando...';
                            this.style.backgroundColor = '#1e5a0f';

                            setTimeout(() => {
                                this.textContent = originalText;
                                this.style.backgroundColor = '';
                            }, 1000);

                            // Cerrar calendario despu√©s de un breve delay
                            setTimeout(() => {
                                const egresosCalendarDropdown = document.getElementById('egresosCalendarDropdown');
                                if (egresosCalendarDropdown) {
                                    gsap.to(egresosCalendarDropdown, {
                                        duration: 0.3,
                                        opacity: 0,
                                        scale: 0.95,
                                        y: -10,
                                        ease: "power2.inOut",
                                        onComplete: function () {
                                            egresosCalendarDropdown.style.display = 'none';
                                        }
                                    });
                                    isEgresosCalendarOpen = false;
                                }
                            }, 500);
                        } else {
                            console.log('‚ö†Ô∏è No hay fecha seleccionada, mostrando error...');
                            // Mostrar mensaje de error m√°s amigable
                            const originalText = this.textContent;
                            this.textContent = '‚ö† Selecciona una fecha';
                            this.style.backgroundColor = '#dc3545';

                            setTimeout(() => {
                                this.textContent = originalText;
                                this.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                }

                // Egresos Monto functionality
                function showEgresosMonto() {
                    console.log('üí∞ Mostrando dropdown de monto de egresos...');

                    const egresosMontoDropdown = document.getElementById('egresosMontoDropdown');

                    if (egresosMontoDropdown) {
                        console.log('‚úÖ Monto dropdown de egresos encontrado');

                        // Cerrar men√∫ de filtros de egresos
                        const egresosFiltersDropdown = document.getElementById('egresosFiltersDropdown');
                        if (egresosFiltersDropdown) {
                            gsap.to(egresosFiltersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosFiltersDropdown.style.display = 'none';
                                }
                            });
                            isEgresosFiltersOpen = false;
                        }

                        // Mostrar dropdown de monto de egresos
                        egresosMontoDropdown.style.display = 'block';
                        console.log('üí∞ Monto dropdown de egresos mostrado');

                        gsap.fromTo(egresosMontoDropdown,
                            { opacity: 0, scale: 0.95, y: -10 },
                            {
                                duration: 0.3,
                                opacity: 1,
                                scale: 1,
                                y: 0,
                                ease: "power2.out"
                            }
                        );
                        isEgresosMontoOpen = true;
                        console.log('‚úÖ Monto dropdown de egresos completamente mostrado');

                        // Actualizar estado de los botones al final
                        updateEgresosMontoButtonStates();
                    } else {
                        console.error('‚ùå Monto dropdown de egresos no encontrado');
                    }
                }

                function updateEgresosMontoButtonStates() {
                    console.log('üîÑ Actualizando estado de botones de monto de egresos...');
                    console.log('üí∞ Variable egresosSelectedMontoRange en updateEgresosMontoButtonStates:', egresosSelectedMontoRange);
                    console.log('üí∞ Tipo de variable en updateEgresosMontoButtonStates:', typeof egresosSelectedMontoRange);

                    const searchEgresosMontoBtn = document.getElementById('egresosSearchMonto');
                    const cancelEgresosMontoBtn = document.getElementById('egresosCancelMonto');

                    console.log('üîç Bot√≥n buscar monto egresos encontrado:', !!searchEgresosMontoBtn);
                    console.log('üîç Bot√≥n cancelar monto egresos encontrado:', !!cancelEgresosMontoBtn);
                    console.log('üí∞ Rango de monto seleccionado en egresos:', egresosSelectedMontoRange);

                    if (searchEgresosMontoBtn) {
                        if (egresosSelectedMontoRange && egresosSelectedMontoRange !== null && egresosSelectedMontoRange !== '') {
                            // Formatear el rango para mostrar de manera m√°s clara
                            let displayRange = egresosSelectedMontoRange;
                            if (egresosSelectedMontoRange === '10000+') {
                                displayRange = '$10,000+';
                            } else {
                                const [min, max] = egresosSelectedMontoRange.split('-');
                                displayRange = `$${parseInt(min).toLocaleString()} - $${parseInt(max).toLocaleString()}`;
                            }
                            searchEgresosMontoBtn.textContent = `Buscar (${displayRange})`;
                            searchEgresosMontoBtn.disabled = false;
                            console.log('‚úÖ Bot√≥n buscar monto egresos actualizado con rango:', displayRange);
                        } else {
                            searchEgresosMontoBtn.textContent = 'Buscar';
                            searchEgresosMontoBtn.disabled = false;
                            console.log('‚ö†Ô∏è Bot√≥n buscar monto egresos sin rango');
                            console.log('‚ö†Ô∏è Valor de egresosSelectedMontoRange:', egresosSelectedMontoRange);
                        }
                    } else {
                        console.error('‚ùå Bot√≥n buscar monto egresos no encontrado');
                    }

                    if (cancelEgresosMontoBtn) {
                        cancelEgresosMontoBtn.textContent = 'Cancelar';
                        cancelEgresosMontoBtn.disabled = false;
                        console.log('‚úÖ Bot√≥n cancelar monto egresos actualizado');
                    } else {
                        console.error('‚ùå Bot√≥n cancelar monto egresos no encontrado');
                    }
                }

                // Egresos monto buttons functionality (direct event listeners)
                const egresosCancelMontoBtn = document.getElementById('egresosCancelMonto');
                const egresosSearchMontoBtn = document.getElementById('egresosSearchMonto');

                // Egresos monto options functionality (direct event listeners)
                const egresosMontoOptions = document.querySelectorAll('#egresosMontoDropdown .monto-option');
                egresosMontoOptions.forEach(option => {
                    option.addEventListener('click', function (e) {
                        console.log('üí∞ Click directo en opci√≥n de monto de egresos detectado');
                        console.log('üîç Elemento clickeado:', this);
                        console.log('üîç Data-range del elemento:', this.getAttribute('data-range'));
                        e.stopPropagation();

                        // Remover selecci√≥n anterior
                        document.querySelectorAll('#egresosMontoDropdown .monto-option.selected').forEach(opt => {
                            opt.classList.remove('selected');
                        });

                        // Agregar selecci√≥n actual
                        this.classList.add('selected');
                        egresosSelectedMontoRange = this.getAttribute('data-range');

                        console.log('üí∞ Rango de monto de egresos seleccionado (direct):', egresosSelectedMontoRange);
                        console.log('üí∞ Variable egresosSelectedMontoRange actualizada a:', egresosSelectedMontoRange);

                        // Actualizar bot√≥n de buscar inmediatamente
                        updateEgresosMontoButtonStates();

                        // Verificar que la variable se mantenga
                        setTimeout(() => {
                            console.log('üîç Verificaci√≥n post-selecci√≥n directa - egresosSelectedMontoRange:', egresosSelectedMontoRange);
                        }, 100);
                    });
                });

                if (egresosCancelMontoBtn) {
                    egresosCancelMontoBtn.addEventListener('click', function (e) {
                        console.log('üîç Click en bot√≥n cancelar monto egresos detectado');
                        e.stopPropagation();

                        const egresosMontoDropdown = document.getElementById('egresosMontoDropdown');
                        if (egresosMontoDropdown) {
                            gsap.to(egresosMontoDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosMontoDropdown.style.display = 'none';
                                }
                            });
                            isEgresosMontoOpen = false;
                        }
                    });
                }

                if (egresosSearchMontoBtn) {
                    egresosSearchMontoBtn.addEventListener('click', function (e) {
                        console.log('üîç Click en bot√≥n buscar monto egresos detectado (direct listener)');
                        console.log('üí∞ Rango de monto seleccionado en egresos:', egresosSelectedMontoRange);
                        console.log('üîç Tipo de variable:', typeof egresosSelectedMontoRange);
                        console.log('üîç Valor exacto:', JSON.stringify(egresosSelectedMontoRange));
                        console.log('üîç Es null?:', egresosSelectedMontoRange === null);
                        console.log('üîç Es undefined?:', egresosSelectedMontoRange === undefined);
                        console.log('üîç Es string vac√≠o?:', egresosSelectedMontoRange === '');

                        // Verificar tambi√©n si hay alguna opci√≥n seleccionada visualmente
                        const selectedOption = document.querySelector('#egresosMontoDropdown .monto-option.selected');
                        console.log('üîç Opci√≥n seleccionada visualmente:', selectedOption);
                        if (selectedOption) {
                            console.log('üîç Data-range de la opci√≥n seleccionada:', selectedOption.getAttribute('data-range'));
                        }

                        e.stopPropagation();

                        // Usar la variable o la opci√≥n seleccionada visualmente
                        const finalRange = egresosSelectedMontoRange || (selectedOption ? selectedOption.getAttribute('data-range') : null);
                        console.log('üîç Rango final a usar:', finalRange);

                        if (finalRange && finalRange !== null && finalRange !== '') {
                            console.log('‚úÖ Rango v√°lido encontrado, procediendo con b√∫squeda...');
                            console.log('üîç B√∫squeda por rango de monto de egresos:', finalRange);

                            // Mostrar feedback visual "Buscando..."
                            const originalText = this.textContent;
                            this.textContent = '‚úì Buscando...';
                            this.style.backgroundColor = '#1e5a0f';

                            setTimeout(() => {
                                this.textContent = originalText;
                                this.style.backgroundColor = '';
                            }, 1000);

                            // Cerrar dropdown despu√©s de un breve delay
                            setTimeout(() => {
                                const egresosMontoDropdown = document.getElementById('egresosMontoDropdown');
                                if (egresosMontoDropdown) {
                                    gsap.to(egresosMontoDropdown, {
                                        duration: 0.3,
                                        opacity: 0,
                                        scale: 0.95,
                                        y: -10,
                                        ease: "power2.inOut",
                                        onComplete: function () {
                                            egresosMontoDropdown.style.display = 'none';
                                        }
                                    });
                                    isEgresosMontoOpen = false;
                                }
                            }, 500);
                        } else {
                            console.log('‚ö†Ô∏è No hay rango seleccionado, mostrando error...');
                            console.log('‚ö†Ô∏è Valor actual de egresosSelectedMontoRange:', egresosSelectedMontoRange);
                            console.log('‚ö†Ô∏è Opci√≥n seleccionada visualmente:', selectedOption);
                            // Mostrar mensaje de error m√°s amigable
                            const originalText = this.textContent;
                            this.textContent = '‚ö† Selecciona un rango';
                            this.style.backgroundColor = '#dc3545';

                            setTimeout(() => {
                                this.textContent = originalText;
                                this.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                }

                // Egresos Descripci√≥n functionality
                function showEgresosDescripcion() {
                    console.log('üìù Mostrando dropdown de descripci√≥n de egresos...');

                    const egresosDescripcionDropdown = document.getElementById('egresosDescripcionDropdown');

                    if (egresosDescripcionDropdown) {
                        console.log('‚úÖ Descripci√≥n dropdown de egresos encontrado');

                        // Cerrar men√∫ de filtros de egresos
                        const egresosFiltersDropdown = document.getElementById('egresosFiltersDropdown');
                        if (egresosFiltersDropdown) {
                            gsap.to(egresosFiltersDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosFiltersDropdown.style.display = 'none';
                                }
                            });
                            isEgresosFiltersOpen = false;
                        }

                        // Mostrar dropdown de descripci√≥n de egresos
                        egresosDescripcionDropdown.style.display = 'block';
                        console.log('üìù Descripci√≥n dropdown de egresos mostrado');

                        gsap.fromTo(egresosDescripcionDropdown,
                            { opacity: 0, scale: 0.95, y: -10 },
                            {
                                duration: 0.3,
                                opacity: 1,
                                scale: 1,
                                y: 0,
                                ease: "power2.out"
                            }
                        );
                        isEgresosDescripcionOpen = true;
                        console.log('‚úÖ Descripci√≥n dropdown de egresos completamente mostrado');

                        // Actualizar estado de los botones al final
                        updateEgresosDescripcionButtonStates();
                    } else {
                        console.error('‚ùå Descripci√≥n dropdown de egresos no encontrado');
                    }
                }

                function updateEgresosDescripcionButtonStates() {
                    console.log('üîÑ Actualizando estado de botones de descripci√≥n de egresos...');

                    const searchEgresosDescripcionBtn = document.getElementById('egresosSearchDescripcion');
                    const cancelEgresosDescripcionBtn = document.getElementById('egresosCancelDescripcion');

                    console.log('üîç Bot√≥n buscar descripci√≥n egresos encontrado:', !!searchEgresosDescripcionBtn);
                    console.log('üîç Bot√≥n cancelar descripci√≥n egresos encontrado:', !!cancelEgresosDescripcionBtn);
                    console.log('üìù Descripci√≥n seleccionada en egresos:', egresosSelectedDescripcion);
                    console.log('üìù Descripci√≥n personalizada en egresos:', egresosCustomDescripcion);

                    if (searchEgresosDescripcionBtn) {
                        if (egresosSelectedDescripcion || egresosCustomDescripcion) {
                            const searchText = egresosCustomDescripcion || egresosSelectedDescripcion;
                            searchEgresosDescripcionBtn.textContent = `Buscar (${searchText})`;
                            searchEgresosDescripcionBtn.disabled = false;
                            console.log('‚úÖ Bot√≥n buscar descripci√≥n egresos actualizado con texto:', searchText);
                        } else {
                            searchEgresosDescripcionBtn.textContent = 'Buscar';
                            searchEgresosDescripcionBtn.disabled = false;
                            console.log('‚ö†Ô∏è Bot√≥n buscar descripci√≥n egresos sin selecci√≥n');
                        }
                    } else {
                        console.error('‚ùå Bot√≥n buscar descripci√≥n egresos no encontrado');
                    }

                    if (cancelEgresosDescripcionBtn) {
                        cancelEgresosDescripcionBtn.textContent = 'Cancelar';
                        cancelEgresosDescripcionBtn.disabled = false;
                        console.log('‚úÖ Bot√≥n cancelar descripci√≥n egresos actualizado');
                    } else {
                        console.error('‚ùå Bot√≥n cancelar descripci√≥n egresos no encontrado');
                    }
                }

                // Egresos descripci√≥n buttons functionality (direct event listeners)
                const egresosCancelDescripcionBtn = document.getElementById('egresosCancelDescripcion');
                const egresosSearchDescripcionBtn = document.getElementById('egresosSearchDescripcion');

                if (egresosCancelDescripcionBtn) {
                    egresosCancelDescripcionBtn.addEventListener('click', function (e) {
                        console.log('üîç Click en bot√≥n cancelar descripci√≥n egresos detectado');
                        e.stopPropagation();

                        const egresosDescripcionDropdown = document.getElementById('egresosDescripcionDropdown');
                        if (egresosDescripcionDropdown) {
                            gsap.to(egresosDescripcionDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    egresosDescripcionDropdown.style.display = 'none';
                                }
                            });
                            isEgresosDescripcionOpen = false;
                        }
                    });
                }

                if (egresosSearchDescripcionBtn) {
                    egresosSearchDescripcionBtn.addEventListener('click', function (e) {
                        console.log('üîç Click en bot√≥n buscar descripci√≥n egresos detectado (direct listener)');
                        console.log('üìù Descripci√≥n seleccionada en egresos:', egresosSelectedDescripcion);
                        console.log('üìù Descripci√≥n personalizada en egresos:', egresosCustomDescripcion);
                        console.log('üîç Tipo de egresosSelectedDescripcion:', typeof egresosSelectedDescripcion);
                        console.log('üîç Tipo de egresosCustomDescripcion:', typeof egresosCustomDescripcion);
                        console.log('üîç Es null egresosSelectedDescripcion?:', egresosSelectedDescripcion === null);
                        console.log('üîç Es undefined egresosSelectedDescripcion?:', egresosSelectedDescripcion === undefined);
                        console.log('üîç Es string vac√≠o egresosCustomDescripcion?:', egresosCustomDescripcion === '');

                        // Verificar tambi√©n si hay alguna opci√≥n seleccionada visualmente
                        const selectedOption = document.querySelector('#egresosDescripcionDropdown .descripcion-option.selected');
                        console.log('üîç Opci√≥n seleccionada visualmente:', selectedOption);
                        if (selectedOption) {
                            console.log('üîç Data-descripcion de la opci√≥n seleccionada:', selectedOption.getAttribute('data-descripcion'));
                        }

                        // Verificar tambi√©n el valor del input
                        const inputValue = document.getElementById('egresosDescripcionInput').value;
                        console.log('üîç Valor actual del input:', inputValue);

                        e.stopPropagation();

                        // Usar las variables o los valores del DOM como respaldo
                        const finalDescripcion = egresosSelectedDescripcion || (selectedOption ? selectedOption.getAttribute('data-descripcion') : null);
                        const finalCustomDescripcion = egresosCustomDescripcion || inputValue;

                        console.log('üîç Descripci√≥n final a usar:', finalDescripcion);
                        console.log('üîç Descripci√≥n personalizada final a usar:', finalCustomDescripcion);

                        if (finalDescripcion || finalCustomDescripcion) {
                            const searchText = finalCustomDescripcion || finalDescripcion;
                            console.log('‚úÖ Texto de b√∫squeda v√°lido encontrado, procediendo con b√∫squeda...');
                            console.log('üîç B√∫squeda por descripci√≥n de egresos:', searchText);

                            // Mostrar feedback visual "Buscando..."
                            const originalText = this.textContent;
                            this.textContent = '‚úì Buscando...';
                            this.style.backgroundColor = '#1e5a0f';

                            setTimeout(() => {
                                this.textContent = originalText;
                                this.style.backgroundColor = '';
                            }, 1000);

                            // Cerrar dropdown despu√©s de un breve delay
                            setTimeout(() => {
                                const egresosDescripcionDropdown = document.getElementById('egresosDescripcionDropdown');
                                if (egresosDescripcionDropdown) {
                                    gsap.to(egresosDescripcionDropdown, {
                                        duration: 0.3,
                                        opacity: 0,
                                        scale: 0.95,
                                        y: -10,
                                        ease: "power2.inOut",
                                        onComplete: function () {
                                            egresosDescripcionDropdown.style.display = 'none';
                                        }
                                    });
                                    isEgresosDescripcionOpen = false;
                                }
                            }, 500);
                        } else {
                            console.log('‚ö†Ô∏è No hay descripci√≥n seleccionada, mostrando error...');
                            console.log('‚ö†Ô∏è Valor actual de egresosSelectedDescripcion:', egresosSelectedDescripcion);
                            console.log('‚ö†Ô∏è Valor actual de egresosCustomDescripcion:', egresosCustomDescripcion);
                            console.log('‚ö†Ô∏è Opci√≥n seleccionada visualmente:', selectedOption);
                            console.log('‚ö†Ô∏è Valor del input:', inputValue);
                            // Mostrar mensaje de error m√°s amigable
                            const originalText = this.textContent;
                            this.textContent = '‚ö† Escribe o selecciona';
                            this.style.backgroundColor = '#dc3545';

                            setTimeout(() => {
                                this.textContent = originalText;
                                this.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                }

                // Egresos descripci√≥n options functionality (direct event listeners)
                const egresosDescripcionOptions = document.querySelectorAll('#egresosDescripcionDropdown .descripcion-option');
                egresosDescripcionOptions.forEach(option => {
                    option.addEventListener('click', function (e) {
                        console.log('üìù Click directo en opci√≥n de descripci√≥n de egresos detectado');
                        console.log('üîç Elemento clickeado:', this);
                        console.log('üîç Data-descripcion del elemento:', this.getAttribute('data-descripcion'));
                        e.stopPropagation();

                        // Remover selecci√≥n anterior
                        document.querySelectorAll('#egresosDescripcionDropdown .descripcion-option.selected').forEach(opt => {
                            opt.classList.remove('selected');
                        });

                        // Agregar selecci√≥n actual
                        this.classList.add('selected');
                        egresosSelectedDescripcion = this.getAttribute('data-descripcion');

                        // Limpiar input personalizado
                        const egresosDescripcionInput = document.getElementById('egresosDescripcionInput');
                        if (egresosDescripcionInput) {
                            egresosDescripcionInput.value = '';
                            egresosCustomDescripcion = '';
                        }

                        console.log('üìù Descripci√≥n de egresos seleccionada (direct):', egresosSelectedDescripcion);
                        console.log('üìù Variable egresosSelectedDescripcion actualizada a:', egresosSelectedDescripcion);

                        // Actualizar bot√≥n de buscar inmediatamente
                        updateEgresosDescripcionButtonStates();

                        // Verificar que la variable se mantenga
                        setTimeout(() => {
                            console.log('üîç Verificaci√≥n post-selecci√≥n directa - egresosSelectedDescripcion:', egresosSelectedDescripcion);
                        }, 100);
                    });
                });

                // Egresos descripci√≥n input functionality (direct event listener)
                const egresosDescripcionInput = document.getElementById('egresosDescripcionInput');
                if (egresosDescripcionInput) {
                    egresosDescripcionInput.addEventListener('input', function (e) {
                        console.log('üìù Input en descripci√≥n personalizada de egresos detectado');
                        console.log('üîç Valor del input:', this.value);
                        e.stopPropagation();

                        // Limpiar selecci√≥n de opciones
                        document.querySelectorAll('#egresosDescripcionDropdown .descripcion-option.selected').forEach(option => {
                            option.classList.remove('selected');
                        });
                        egresosSelectedDescripcion = null;

                        // Actualizar descripci√≥n personalizada
                        egresosCustomDescripcion = this.value;

                        console.log('üìù Descripci√≥n personalizada de egresos actualizada:', egresosCustomDescripcion);
                        console.log('üîÑ Actualizando bot√≥n de buscar...');

                        // Actualizar bot√≥n de buscar inmediatamente
                        updateEgresosDescripcionButtonStates();

                        // Verificar que la variable se mantenga
                        setTimeout(() => {
                            console.log('üîç Verificaci√≥n post-input - egresosCustomDescripcion:', egresosCustomDescripcion);
                        }, 100);
                    });
                }

                // Balance toggle functionality
                const balanceToggle = document.getElementById('balanceToggle');
                const balanceAmount = document.getElementById('balanceAmount');
                const eyeIcon = document.getElementById('eyeIcon');
                const finniImage = document.getElementById('finniImage');
                let isBalanceVisible = true;

                if (balanceToggle && balanceAmount && eyeIcon && finniImage) {
                    balanceToggle.addEventListener('click', function () {
                        if (isBalanceVisible) {
                            // Ocultar balance con efecto blur
                            gsap.to(balanceAmount, {
                                duration: 0.4,
                                filter: "blur(8px)",
                                opacity: 0.3,
                                ease: "power2.inOut"
                            });

                            // Cambiar icono a ver.svg
                            eyeIcon.src = "{{ url_for('static', filename='img/ver.svg') }}";
                            eyeIcon.alt = "Mostrar balance";

                            // Cambiar Finni a Finni2.png
                            finniImage.src = "{{ url_for('static', filename='img/Finni2.png') }}";

                            isBalanceVisible = false;
                        } else {
                            // Mostrar balance removiendo el blur
                            gsap.to(balanceAmount, {
                                duration: 0.4,
                                filter: "blur(0px)",
                                opacity: 1,
                                ease: "power2.out"
                            });

                            // Cambiar icono a ocultar.svg
                            eyeIcon.src = "{{ url_for('static', filename='img/ocultar.svg') }}";
                            eyeIcon.alt = "Ocultar balance";

                            // Cambiar Finni a Finni1.png
                            finniImage.src = "{{ url_for('static', filename='img/Finni1.png') }}";

                            isBalanceVisible = true;
                        }
                    });
                }

                // Calendar functionality
                let currentDate = new Date();
                let selectedDate = null;
                let isCalendarOpen = false;

                // Monto functionality
                let selectedMontoRange = null;
                let isMontoOpen = false;

                // Descripci√≥n functionality
                let selectedDescripcion = null;
                let customDescripcion = '';
                let isDescripcionOpen = false;

                // Egresos functionality
                let isEgresosFiltersOpen = false;
                let egresosCurrentDate = new Date();
                let egresosSelectedDate = null;
                let isEgresosCalendarOpen = false;
                let egresosSelectedMontoRange = null;
                let isEgresosMontoOpen = false;
                let egresosSelectedDescripcion = null;
                let egresosCustomDescripcion = '';
                let isEgresosDescripcionOpen = false;

                function showCalendar() {
                    console.log('üìÖ Mostrando calendario...');

                    const calendarDropdown = document.getElementById('calendarDropdown');

                    if (calendarDropdown) {
                        console.log('‚úÖ Calendario dropdown encontrado');

                        // Cerrar men√∫ de filtros
                        gsap.to(filtersDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                filtersDropdown.style.display = 'none';
                            }
                        });
                        isFiltersOpen = false;

                        // Mostrar calendario
                        calendarDropdown.style.display = 'block';
                        console.log('üìÖ Calendario mostrado, generando contenido...');
                        generateCalendar();

                        gsap.fromTo(calendarDropdown,
                            { opacity: 0, scale: 0.95, y: -10 },
                            {
                                duration: 0.3,
                                opacity: 1,
                                scale: 1,
                                y: 0,
                                ease: "power2.out"
                            }
                        );
                        isCalendarOpen = true;
                        console.log('‚úÖ Calendario completamente mostrado');
                    } else {
                        console.error('‚ùå Calendario dropdown no encontrado');
                    }
                }

                function showMonto() {
                    console.log('üí∞ Mostrando dropdown de montos...');

                    const montoDropdown = document.getElementById('montoDropdown');

                    if (montoDropdown) {
                        console.log('‚úÖ Monto dropdown encontrado');

                        // Cerrar men√∫ de filtros
                        gsap.to(filtersDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                filtersDropdown.style.display = 'none';
                            }
                        });
                        isFiltersOpen = false;

                        // Mostrar dropdown de montos
                        montoDropdown.style.display = 'block';
                        console.log('üí∞ Monto dropdown mostrado');

                        // Forzar visibilidad de botones inmediatamente
                        setTimeout(() => {
                            const searchMontoBtn = document.getElementById('searchMonto');
                            const cancelMontoBtn = document.getElementById('cancelMonto');

                            if (searchMontoBtn) {
                                searchMontoBtn.style.display = 'inline-block !important';
                                searchMontoBtn.style.visibility = 'visible !important';
                                searchMontoBtn.style.opacity = '1 !important';
                                searchMontoBtn.style.position = 'relative !important';
                                searchMontoBtn.style.zIndex = '1001 !important';
                                searchMontoBtn.style.backgroundColor = '#ffffff !important';
                                searchMontoBtn.style.color = '#2F851D !important';
                                searchMontoBtn.style.border = '3px solid #ffffff !important';
                                searchMontoBtn.style.minWidth = '70px !important';
                                searchMontoBtn.style.padding = '8px 16px !important';
                                console.log('üîß Bot√≥n buscar monto forzado a visible con estilos completos');
                            }

                            if (cancelMontoBtn) {
                                cancelMontoBtn.style.display = 'inline-block !important';
                                cancelMontoBtn.style.visibility = 'visible !important';
                                cancelMontoBtn.style.opacity = '1 !important';
                                cancelMontoBtn.style.position = 'relative !important';
                                cancelMontoBtn.style.zIndex = '1001 !important';
                                cancelMontoBtn.style.backgroundColor = '#ffffff !important';
                                cancelMontoBtn.style.color = '#2F851D !important';
                                cancelMontoBtn.style.border = '3px solid #ffffff !important';
                                cancelMontoBtn.style.minWidth = '70px !important';
                                cancelMontoBtn.style.padding = '8px 16px !important';
                                console.log('üîß Bot√≥n cancelar monto forzado a visible con estilos completos');
                            }
                        }, 100);

                        gsap.fromTo(montoDropdown,
                            { opacity: 0, scale: 0.95, y: -10 },
                            {
                                duration: 0.3,
                                opacity: 1,
                                scale: 1,
                                y: 0,
                                ease: "power2.out"
                            }
                        );
                        isMontoOpen = true;
                        console.log('‚úÖ Monto dropdown completamente mostrado');

                        // Actualizar estado de los botones al final
                        updateMontoButtonStates();
                    } else {
                        console.error('‚ùå Monto dropdown no encontrado');
                    }
                }

                function showDescripcion() {
                    console.log('üìù Mostrando dropdown de descripci√≥n...');

                    const descripcionDropdown = document.getElementById('descripcionDropdown');

                    if (descripcionDropdown) {
                        console.log('‚úÖ Descripci√≥n dropdown encontrado');

                        // Cerrar men√∫ de filtros
                        gsap.to(filtersDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                filtersDropdown.style.display = 'none';
                            }
                        });
                        isFiltersOpen = false;

                        // Mostrar dropdown de descripci√≥n
                        descripcionDropdown.style.display = 'block';
                        console.log('üìù Descripci√≥n dropdown mostrado');

                        // Forzar visibilidad de botones inmediatamente
                        setTimeout(() => {
                            const searchDescripcionBtn = document.getElementById('searchDescripcion');
                            const cancelDescripcionBtn = document.getElementById('cancelDescripcion');

                            if (searchDescripcionBtn) {
                                searchDescripcionBtn.style.display = 'inline-block !important';
                                searchDescripcionBtn.style.visibility = 'visible !important';
                                searchDescripcionBtn.style.opacity = '1 !important';
                                searchDescripcionBtn.style.position = 'relative !important';
                                searchDescripcionBtn.style.zIndex = '1001 !important';
                                searchDescripcionBtn.style.backgroundColor = '#ffffff !important';
                                searchDescripcionBtn.style.color = '#2F851D !important';
                                searchDescripcionBtn.style.border = '4px solid #ffffff !important';
                                searchDescripcionBtn.style.minWidth = '90px !important';
                                searchDescripcionBtn.style.padding = '10px 20px !important';
                                searchDescripcionBtn.style.fontSize = '0.9rem !important';
                                searchDescripcionBtn.style.fontWeight = '700 !important';
                                searchDescripcionBtn.style.boxShadow = '0 3px 6px rgba(0, 0, 0, 0.3) !important';
                                console.log('üîß Bot√≥n buscar descripci√≥n forzado a visible con estilos completos');
                            }

                            if (cancelDescripcionBtn) {
                                cancelDescripcionBtn.style.display = 'inline-block !important';
                                cancelDescripcionBtn.style.visibility = 'visible !important';
                                cancelDescripcionBtn.style.opacity = '1 !important';
                                cancelDescripcionBtn.style.position = 'relative !important';
                                cancelDescripcionBtn.style.zIndex = '1001 !important';
                                cancelDescripcionBtn.style.backgroundColor = '#ffffff !important';
                                cancelDescripcionBtn.style.color = '#2F851D !important';
                                cancelDescripcionBtn.style.border = '4px solid #ffffff !important';
                                cancelDescripcionBtn.style.minWidth = '90px !important';
                                cancelDescripcionBtn.style.padding = '10px 20px !important';
                                cancelDescripcionBtn.style.fontSize = '0.9rem !important';
                                cancelDescripcionBtn.style.fontWeight = '700 !important';
                                cancelDescripcionBtn.style.boxShadow = '0 3px 6px rgba(0, 0, 0, 0.3) !important';
                                console.log('üîß Bot√≥n cancelar descripci√≥n forzado a visible con estilos completos');
                            }
                        }, 100);

                        gsap.fromTo(descripcionDropdown,
                            { opacity: 0, scale: 0.95, y: -10 },
                            {
                                duration: 0.3,
                                opacity: 1,
                                scale: 1,
                                y: 0,
                                ease: "power2.out"
                            }
                        );
                        isDescripcionOpen = true;
                        console.log('‚úÖ Descripci√≥n dropdown completamente mostrado');

                        // Actualizar estado de los botones al final
                        updateDescripcionButtonStates();
                    } else {
                        console.error('‚ùå Descripci√≥n dropdown no encontrado');
                    }
                }

                function updateMontoButtonStates() {
                    console.log('üîÑ Actualizando estado de botones de monto...');

                    const searchMontoBtn = document.getElementById('searchMonto');
                    const cancelMontoBtn = document.getElementById('cancelMonto');

                    console.log('üîç Bot√≥n buscar monto encontrado:', !!searchMontoBtn);
                    console.log('‚ùå Bot√≥n cancelar monto encontrado:', !!cancelMontoBtn);
                    console.log('üí∞ Rango de monto seleccionado:', selectedMontoRange);

                    if (searchMontoBtn) {
                        // Forzar visibilidad con estilos completos
                        searchMontoBtn.style.display = 'inline-block !important';
                        searchMontoBtn.style.visibility = 'visible !important';
                        searchMontoBtn.style.opacity = '1 !important';
                        searchMontoBtn.style.position = 'relative !important';
                        searchMontoBtn.style.zIndex = '1001 !important';
                        searchMontoBtn.style.backgroundColor = '#ffffff !important';
                        searchMontoBtn.style.color = '#2F851D !important';
                        searchMontoBtn.style.border = '3px solid #ffffff !important';
                        searchMontoBtn.style.minWidth = '70px !important';
                        searchMontoBtn.style.padding = '8px 16px !important';
                        searchMontoBtn.style.fontSize = '0.8rem !important';
                        searchMontoBtn.style.fontWeight = '600 !important';

                        if (selectedMontoRange) {
                            // Formatear el rango para mostrar de manera m√°s clara
                            let displayRange = selectedMontoRange;
                            if (selectedMontoRange === '10000+') {
                                displayRange = '$10,000+';
                            } else {
                                const [min, max] = selectedMontoRange.split('-');
                                displayRange = `$${parseInt(min).toLocaleString()} - $${parseInt(max).toLocaleString()}`;
                            }
                            searchMontoBtn.textContent = `Buscar (${displayRange})`;
                            searchMontoBtn.disabled = false;
                            console.log('‚úÖ Bot√≥n buscar monto actualizado con rango:', displayRange);
                        } else {
                            searchMontoBtn.textContent = 'Buscar';
                            searchMontoBtn.disabled = false;
                            console.log('‚ö†Ô∏è Bot√≥n buscar monto sin rango');
                        }
                        console.log('üîç Bot√≥n buscar monto estilos:', searchMontoBtn.style.cssText);
                    } else {
                        console.error('‚ùå Bot√≥n buscar monto no encontrado');
                    }

                    if (cancelMontoBtn) {
                        // Forzar visibilidad con estilos completos
                        cancelMontoBtn.style.display = 'inline-block !important';
                        cancelMontoBtn.style.visibility = 'visible !important';
                        cancelMontoBtn.style.opacity = '1 !important';
                        cancelMontoBtn.style.position = 'relative !important';
                        cancelMontoBtn.style.zIndex = '1001 !important';
                        cancelMontoBtn.style.backgroundColor = '#ffffff !important';
                        cancelMontoBtn.style.color = '#2F851D !important';
                        cancelMontoBtn.style.border = '3px solid #ffffff !important';
                        cancelMontoBtn.style.minWidth = '70px !important';
                        cancelMontoBtn.style.padding = '8px 16px !important';
                        cancelMontoBtn.style.fontSize = '0.8rem !important';
                        cancelMontoBtn.style.fontWeight = '600 !important';

                        cancelMontoBtn.textContent = 'Cancelar';
                        cancelMontoBtn.disabled = false;
                        console.log('‚úÖ Bot√≥n cancelar monto actualizado');
                        console.log('üîç Bot√≥n cancelar monto estilos:', cancelMontoBtn.style.cssText);
                    } else {
                        console.error('‚ùå Bot√≥n cancelar monto no encontrado');
                    }

                    // Verificar que los botones est√©n en el DOM
                    const montoActionsContainer = document.querySelector('.monto-actions');
                    console.log('üì¶ Contenedor de acciones monto encontrado:', !!montoActionsContainer);
                    if (montoActionsContainer) {
                        console.log('üì¶ Contenido del contenedor monto:', montoActionsContainer.innerHTML);
                        console.log('üì¶ Estilos del contenedor monto:', montoActionsContainer.style.cssText);
                    }
                }

                function updateDescripcionButtonStates() {
                    console.log('üîÑ Actualizando estado de botones de descripci√≥n...');

                    const searchDescripcionBtn = document.getElementById('searchDescripcion');
                    const cancelDescripcionBtn = document.getElementById('cancelDescripcion');

                    console.log('üîç Bot√≥n buscar descripci√≥n encontrado:', !!searchDescripcionBtn);
                    console.log('‚ùå Bot√≥n cancelar descripci√≥n encontrado:', !!cancelDescripcionBtn);
                    console.log('üìù Descripci√≥n seleccionada:', selectedDescripcion);
                    console.log('üìù Descripci√≥n personalizada:', customDescripcion);

                    if (searchDescripcionBtn) {
                        // Forzar visibilidad con estilos completos
                        searchDescripcionBtn.style.display = 'inline-block !important';
                        searchDescripcionBtn.style.visibility = 'visible !important';
                        searchDescripcionBtn.style.opacity = '1 !important';
                        searchDescripcionBtn.style.position = 'relative !important';
                        searchDescripcionBtn.style.zIndex = '101 !important';
                        searchDescripcionBtn.style.backgroundColor = '#ffffff !important';
                        searchDescripcionBtn.style.color = '#2F851D !important';
                        searchDescripcionBtn.style.border = '2px solid #ffffff !important';
                        searchDescripcionBtn.style.minWidth = '50px !important';
                        searchDescripcionBtn.style.padding = '4px 8px !important';
                        searchDescripcionBtn.style.fontSize = '0.7rem !important';
                        searchDescripcionBtn.style.fontWeight = '500 !important';
                        searchDescripcionBtn.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.1) !important';

                        if (selectedDescripcion || customDescripcion) {
                            const searchText = customDescripcion || selectedDescripcion;
                            searchDescripcionBtn.textContent = `Buscar (${searchText})`;
                            searchDescripcionBtn.disabled = false;
                            console.log('‚úÖ Bot√≥n buscar descripci√≥n actualizado con texto:', searchText);
                        } else {
                            searchDescripcionBtn.textContent = 'Buscar';
                            searchDescripcionBtn.disabled = false;
                            console.log('‚ö†Ô∏è Bot√≥n buscar descripci√≥n sin selecci√≥n');
                        }
                        console.log('üîç Bot√≥n buscar descripci√≥n estilos:', searchDescripcionBtn.style.cssText);
                    } else {
                        console.error('‚ùå Bot√≥n buscar descripci√≥n no encontrado');
                    }

                    if (cancelDescripcionBtn) {
                        // Forzar visibilidad con estilos completos
                        cancelDescripcionBtn.style.display = 'inline-block !important';
                        cancelDescripcionBtn.style.visibility = 'visible !important';
                        cancelDescripcionBtn.style.opacity = '1 !important';
                        cancelDescripcionBtn.style.position = 'relative !important';
                        cancelDescripcionBtn.style.zIndex = '101 !important';
                        cancelDescripcionBtn.style.backgroundColor = '#ffffff !important';
                        cancelDescripcionBtn.style.color = '#2F851D !important';
                        cancelDescripcionBtn.style.border = '2px solid #ffffff !important';
                        cancelDescripcionBtn.style.minWidth = '50px !important';
                        cancelDescripcionBtn.style.padding = '4px 8px !important';
                        cancelDescripcionBtn.style.fontSize = '0.7rem !important';
                        cancelDescripcionBtn.style.fontWeight = '500 !important';
                        cancelDescripcionBtn.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.1) !important';

                        cancelDescripcionBtn.textContent = 'Cancelar';
                        cancelDescripcionBtn.disabled = false;
                        console.log('‚úÖ Bot√≥n cancelar descripci√≥n actualizado');
                        console.log('üîç Bot√≥n cancelar descripci√≥n estilos:', cancelDescripcionBtn.style.cssText);
                    } else {
                        console.error('‚ùå Bot√≥n cancelar descripci√≥n no encontrado');
                    }

                    // Verificar que los botones est√©n en el DOM
                    const descripcionActionsContainer = document.querySelector('.descripcion-actions');
                    console.log('üì¶ Contenedor de acciones descripci√≥n encontrado:', !!descripcionActionsContainer);
                    if (descripcionActionsContainer) {
                        console.log('üì¶ Contenido del contenedor descripci√≥n:', descripcionActionsContainer.innerHTML);
                        console.log('üì¶ Estilos del contenedor descripci√≥n:', descripcionActionsContainer.style.cssText);
                    }
                }

                function generateCalendar() {
                    const currentMonthElement = document.getElementById('currentMonth');
                    const calendarGrid = document.getElementById('calendarGrid');

                    if (!currentMonthElement || !calendarGrid) {
                        console.error('‚ùå Elementos del calendario no encontrados');
                        return;
                    }

                    console.log('üìÖ Generando calendario...');

                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth();

                    // Nombres de los meses
                    const monthNames = [
                        'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                        'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                    ];

                    currentMonthElement.textContent = `${monthNames[month]} ${year}`;

                    // D√≠as de la semana
                    const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];

                    // Limpiar grid completamente
                    calendarGrid.innerHTML = '';

                    // Agregar headers de d√≠as
                    dayHeaders.forEach(day => {
                        const dayHeader = document.createElement('div');
                        dayHeader.className = 'calendar-day-header';
                        dayHeader.textContent = day;
                        calendarGrid.appendChild(dayHeader);
                    });

                    // Obtener primer d√≠a del mes y n√∫mero de d√≠as
                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const daysInMonth = lastDay.getDate();
                    const startingDay = firstDay.getDay();

                    // D√≠as del mes anterior
                    const prevMonth = new Date(year, month - 1, 0);
                    const daysInPrevMonth = prevMonth.getDate();

                    for (let i = startingDay - 1; i >= 0; i--) {
                        const dayButton = document.createElement('button');
                        dayButton.className = 'calendar-day other-month';
                        dayButton.textContent = daysInPrevMonth - i;
                        calendarGrid.appendChild(dayButton);
                    }

                    // D√≠as del mes actual
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayButton = document.createElement('button');
                        dayButton.className = 'calendar-day';
                        dayButton.textContent = day;

                        const currentDay = new Date();
                        if (day === currentDay.getDate() && month === currentDay.getMonth() && year === currentDay.getFullYear()) {
                            dayButton.classList.add('today');
                        }

                        dayButton.addEventListener('click', function () {
                            console.log('üñ±Ô∏è Click en d√≠a:', day);

                            // Remover selecci√≥n anterior de TODOS los d√≠as
                            document.querySelectorAll('.calendar-day.selected').forEach(day => {
                                day.classList.remove('selected');
                            });

                            // Agregar selecci√≥n actual
                            this.classList.add('selected');
                            selectedDate = new Date(year, month, day);

                            console.log('üìÖ Fecha seleccionada:', selectedDate.toLocaleDateString('es-ES'));

                            // Actualizar estado de los botones
                            updateButtonStates();
                        });

                        calendarGrid.appendChild(dayButton);
                    }

                    // D√≠as del mes siguiente
                    const remainingDays = 42 - (startingDay + daysInMonth);
                    for (let day = 1; day <= remainingDays; day++) {
                        const dayButton = document.createElement('button');
                        dayButton.className = 'calendar-day other-month';
                        dayButton.textContent = day;
                        calendarGrid.appendChild(dayButton);
                    }

                    console.log('‚úÖ Calendario generado correctamente');

                    // Forzar visibilidad de botones inmediatamente
                    setTimeout(() => {
                        const searchBtn = document.getElementById('searchDate');
                        const cancelBtn = document.getElementById('cancelDate');

                        if (searchBtn) {
                            searchBtn.style.display = 'inline-block !important';
                            searchBtn.style.visibility = 'visible !important';
                            searchBtn.style.opacity = '1 !important';
                            console.log('üîß Bot√≥n buscar forzado a visible');
                        }

                        if (cancelBtn) {
                            cancelBtn.style.display = 'inline-block !important';
                            cancelBtn.style.visibility = 'visible !important';
                            cancelBtn.style.opacity = '1 !important';
                            console.log('üîß Bot√≥n cancelar forzado a visible');
                        }
                    }, 100);

                    // Actualizar estado de los botones al final
                    updateButtonStates();
                }

                function updateButtonStates() {
                    console.log('üîÑ Actualizando estado de botones...');

                    const searchBtn = document.getElementById('searchDate');
                    const cancelBtn = document.getElementById('cancelDate');

                    console.log('üîç Bot√≥n buscar encontrado:', !!searchBtn);
                    console.log('‚ùå Bot√≥n cancelar encontrado:', !!cancelBtn);
                    console.log('üìÖ Fecha seleccionada:', selectedDate);

                    if (searchBtn) {
                        // Forzar visibilidad con estilos completos
                        searchBtn.style.display = 'inline-block !important';
                        searchBtn.style.visibility = 'visible !important';
                        searchBtn.style.opacity = '1 !important';
                        searchBtn.style.position = 'relative !important';
                        searchBtn.style.zIndex = '101 !important';
                        searchBtn.style.backgroundColor = '#ffffff !important';
                        searchBtn.style.color = '#2F851D !important';
                        searchBtn.style.border = '2px solid #ffffff !important';
                        searchBtn.style.minWidth = '50px !important';
                        searchBtn.style.padding = '4px 8px !important';
                        searchBtn.style.fontSize = '0.7rem !important';
                        searchBtn.style.fontWeight = '500 !important';
                        searchBtn.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.1) !important';

                        if (selectedDate) {
                            searchBtn.textContent = `Buscar (${selectedDate.toLocaleDateString('es-ES')})`;
                            searchBtn.disabled = false;
                            console.log('‚úÖ Bot√≥n buscar actualizado con fecha');
                        } else {
                            searchBtn.textContent = 'Buscar';
                            searchBtn.disabled = false;
                            console.log('‚ö†Ô∏è Bot√≥n buscar sin fecha');
                        }
                        console.log('üîç Bot√≥n buscar estilos:', searchBtn.style.cssText);
                    } else {
                        console.error('‚ùå Bot√≥n buscar no encontrado');
                    }

                    if (cancelBtn) {
                        // Forzar visibilidad con estilos completos
                        cancelBtn.style.display = 'inline-block !important';
                        cancelBtn.style.visibility = 'visible !important';
                        cancelBtn.style.opacity = '1 !important';
                        cancelBtn.style.position = 'relative !important';
                        cancelBtn.style.zIndex = '101 !important';
                        cancelBtn.style.backgroundColor = '#ffffff !important';
                        cancelBtn.style.color = '#2F851D !important';
                        cancelBtn.style.border = '2px solid #ffffff !important';
                        cancelBtn.style.minWidth = '50px !important';
                        cancelBtn.style.padding = '4px 8px !important';
                        cancelBtn.style.fontSize = '0.7rem !important';
                        cancelBtn.style.fontWeight = '500 !important';
                        cancelBtn.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.1) !important';

                        cancelBtn.textContent = 'Cancelar';
                        cancelBtn.disabled = false;
                        console.log('‚úÖ Bot√≥n cancelar actualizado');
                        console.log('üîç Bot√≥n cancelar estilos:', cancelBtn.style.cssText);
                    } else {
                        console.error('‚ùå Bot√≥n cancelar no encontrado');
                    }

                    // Verificar que los botones est√©n en el DOM
                    const actionsContainer = document.querySelector('.calendar-actions');
                    console.log('üì¶ Contenedor de acciones encontrado:', !!actionsContainer);
                    if (actionsContainer) {
                        console.log('üì¶ Contenido del contenedor:', actionsContainer.innerHTML);
                        console.log('üì¶ Estilos del contenedor:', actionsContainer.style.cssText);
                    }
                }

                // Event listeners para navegaci√≥n del calendario usando delegaci√≥n de eventos
                document.addEventListener('click', function (e) {
                    // Navegaci√≥n por a√±o
                    if (e.target && e.target.id === 'prevYear') {
                        currentDate.setFullYear(currentDate.getFullYear() - 1);
                        generateCalendar();
                    }

                    if (e.target && e.target.id === 'nextYear') {
                        currentDate.setFullYear(currentDate.getFullYear() + 1);
                        generateCalendar();
                    }

                    // Navegaci√≥n por mes
                    if (e.target && e.target.id === 'prevMonth') {
                        currentDate.setMonth(currentDate.getMonth() - 1);
                        generateCalendar();
                    }

                    if (e.target && e.target.id === 'nextMonth') {
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        generateCalendar();
                    }

                    // Bot√≥n cancelar
                    if (e.target && e.target.id === 'cancelDate') {
                        // Mostrar feedback visual
                        const cancelBtn = e.target;
                        const originalText = cancelBtn.textContent;
                        cancelBtn.textContent = '‚úó Cancelando...';
                        cancelBtn.style.backgroundColor = '#6c757d';

                        setTimeout(() => {
                            cancelBtn.textContent = originalText;
                            cancelBtn.style.backgroundColor = '';
                        }, 500);

                        // Cerrar calendario sin aplicar filtro
                        const calendarDropdown = document.getElementById('calendarDropdown');
                        if (calendarDropdown) {
                            gsap.to(calendarDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    calendarDropdown.style.display = 'none';
                                }
                            });
                            isCalendarOpen = false;
                        }
                    }

                    // Bot√≥n buscar
                    if (e.target && e.target.id === 'searchDate') {
                        if (selectedDate) {
                            console.log('üîç B√∫squeda por fecha:', selectedDate.toLocaleDateString('es-ES'));

                            // Aqu√≠ puedes agregar la l√≥gica de filtrado por fecha
                            // Por ejemplo: filtrarMovimientosPorFecha(selectedDate);

                            // Mostrar mensaje de confirmaci√≥n
                            const searchBtn = e.target;
                            const originalText = searchBtn.textContent;
                            searchBtn.textContent = '‚úì Buscando...';
                            searchBtn.style.backgroundColor = '#1e5a0f';

                            setTimeout(() => {
                                searchBtn.textContent = originalText;
                                searchBtn.style.backgroundColor = '';
                            }, 1000);

                            // Cerrar calendario despu√©s de un breve delay
                            setTimeout(() => {
                                const calendarDropdown = document.getElementById('calendarDropdown');
                                if (calendarDropdown) {
                                    gsap.to(calendarDropdown, {
                                        duration: 0.3,
                                        opacity: 0,
                                        scale: 0.95,
                                        y: -10,
                                        ease: "power2.inOut",
                                        onComplete: function () {
                                            calendarDropdown.style.display = 'none';
                                        }
                                    });
                                    isCalendarOpen = false;
                                }
                            }, 500);
                        } else {
                            // Mostrar mensaje de error m√°s amigable
                            const searchBtn = e.target;
                            const originalText = searchBtn.textContent;
                            searchBtn.textContent = '‚ö† Selecciona una fecha';
                            searchBtn.style.backgroundColor = '#dc3545';

                            setTimeout(() => {
                                searchBtn.textContent = originalText;
                                searchBtn.style.backgroundColor = '';
                            }, 2000);
                        }
                    }

                    // Cerrar calendario al hacer click fuera
                    const calendarDropdown = document.getElementById('calendarDropdown');
                    if (isCalendarOpen && calendarDropdown && !calendarDropdown.contains(e.target) && !document.getElementById('fechaButton').contains(e.target)) {
                        gsap.to(calendarDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                calendarDropdown.style.display = 'none';
                            }
                        });
                        isCalendarOpen = false;
                    }

                    // Cerrar monto dropdown al hacer click fuera
                    const montoDropdown = document.getElementById('montoDropdown');
                    if (isMontoOpen && montoDropdown && !montoDropdown.contains(e.target) && !document.getElementById('montoButton').contains(e.target)) {
                        gsap.to(montoDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                montoDropdown.style.display = 'none';
                            }
                        });
                        isMontoOpen = false;
                    }

                    // Cerrar descripci√≥n dropdown al hacer click fuera
                    const descripcionDropdown = document.getElementById('descripcionDropdown');
                    if (isDescripcionOpen && descripcionDropdown && !descripcionDropdown.contains(e.target) && !document.getElementById('descripcionButton').contains(e.target)) {
                        gsap.to(descripcionDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                descripcionDropdown.style.display = 'none';
                            }
                        });
                        isDescripcionOpen = false;
                    }

                    // Selecci√≥n de rango de monto
                    if (e.target && e.target.classList.contains('monto-option')) {
                        // Remover selecci√≥n anterior
                        document.querySelectorAll('.monto-option.selected').forEach(option => {
                            option.classList.remove('selected');
                        });

                        // Agregar selecci√≥n actual
                        e.target.classList.add('selected');
                        selectedMontoRange = e.target.getAttribute('data-range');

                        console.log('üí∞ Rango de monto seleccionado:', selectedMontoRange);
                        console.log('üîÑ Actualizando bot√≥n de buscar...');

                        // Actualizar bot√≥n de buscar inmediatamente
                        updateMontoButtonStates();
                    }

                    // Selecci√≥n de opci√≥n de descripci√≥n
                    if (e.target && e.target.classList.contains('descripcion-option')) {
                        // Remover selecci√≥n anterior
                        document.querySelectorAll('.descripcion-option.selected').forEach(option => {
                            option.classList.remove('selected');
                        });

                        // Agregar selecci√≥n actual
                        e.target.classList.add('selected');
                        selectedDescripcion = e.target.getAttribute('data-descripcion');

                        // Limpiar input personalizado
                        const descripcionInput = document.getElementById('descripcionInput');
                        if (descripcionInput) {
                            descripcionInput.value = '';
                            customDescripcion = '';
                        }

                        console.log('üìù Descripci√≥n seleccionada:', selectedDescripcion);
                        console.log('üîÑ Actualizando bot√≥n de buscar...');

                        // Actualizar bot√≥n de buscar inmediatamente
                        updateDescripcionButtonStates();
                    }

                    // Input de descripci√≥n personalizada
                    if (e.target && e.target.id === 'descripcionInput') {
                        const input = e.target;

                        // Limpiar selecci√≥n de opciones
                        document.querySelectorAll('.descripcion-option.selected').forEach(option => {
                            option.classList.remove('selected');
                        });
                        selectedDescripcion = null;

                        // Actualizar descripci√≥n personalizada
                        customDescripcion = input.value;

                        console.log('üìù Descripci√≥n personalizada:', customDescripcion);
                        console.log('üîÑ Actualizando bot√≥n de buscar...');

                        // Actualizar bot√≥n de buscar inmediatamente
                        updateDescripcionButtonStates();
                    }

                    // Bot√≥n cancelar monto
                    if (e.target && e.target.id === 'cancelMonto') {
                        const montoDropdown = document.getElementById('montoDropdown');
                        if (montoDropdown) {
                            gsap.to(montoDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    montoDropdown.style.display = 'none';
                                }
                            });
                            isMontoOpen = false;
                        }
                    }

                    // Bot√≥n buscar monto
                    if (e.target && e.target.id === 'searchMonto') {
                        if (selectedMontoRange) {
                            console.log('üîç B√∫squeda por rango de monto:', selectedMontoRange);

                            // Mostrar feedback visual "Buscando..."
                            const searchMontoBtn = e.target;
                            const originalText = searchMontoBtn.textContent;
                            searchMontoBtn.textContent = '‚úì Buscando...';
                            searchMontoBtn.style.backgroundColor = '#1e5a0f';

                            setTimeout(() => {
                                searchMontoBtn.textContent = originalText;
                                searchMontoBtn.style.backgroundColor = '';
                            }, 1000);

                            // Cerrar dropdown despu√©s de un breve delay
                            setTimeout(() => {
                                const montoDropdown = document.getElementById('montoDropdown');
                                if (montoDropdown) {
                                    gsap.to(montoDropdown, {
                                        duration: 0.3,
                                        opacity: 0,
                                        scale: 0.95,
                                        y: -10,
                                        ease: "power2.inOut",
                                        onComplete: function () {
                                            montoDropdown.style.display = 'none';
                                        }
                                    });
                                    isMontoOpen = false;
                                }
                            }, 500);
                        } else {
                            // Mostrar mensaje de error m√°s amigable
                            const searchMontoBtn = e.target;
                            const originalText = searchMontoBtn.textContent;
                            searchMontoBtn.textContent = '‚ö† Selecciona un rango';
                            searchMontoBtn.style.backgroundColor = '#dc3545';

                            setTimeout(() => {
                                searchMontoBtn.textContent = originalText;
                                searchMontoBtn.style.backgroundColor = '';
                            }, 2000);
                        }
                    }

                    // Bot√≥n cancelar descripci√≥n
                    if (e.target && e.target.id === 'cancelDescripcion') {
                        const descripcionDropdown = document.getElementById('descripcionDropdown');
                        if (descripcionDropdown) {
                            gsap.to(descripcionDropdown, {
                                duration: 0.3,
                                opacity: 0,
                                scale: 0.95,
                                y: -10,
                                ease: "power2.inOut",
                                onComplete: function () {
                                    descripcionDropdown.style.display = 'none';
                                }
                            });
                            isDescripcionOpen = false;
                        }
                    }

                    // Bot√≥n buscar descripci√≥n
                    if (e.target && e.target.id === 'searchDescripcion') {
                        if (selectedDescripcion || customDescripcion) {
                            const searchText = customDescripcion || selectedDescripcion;
                            console.log('üîç B√∫squeda por descripci√≥n:', searchText);

                            // Mostrar feedback visual "Buscando..."
                            const searchDescripcionBtn = e.target;
                            const originalText = searchDescripcionBtn.textContent;
                            searchDescripcionBtn.textContent = '‚úì Buscando...';
                            searchDescripcionBtn.style.backgroundColor = '#1e5a0f';

                            setTimeout(() => {
                                searchDescripcionBtn.textContent = originalText;
                                searchDescripcionBtn.style.backgroundColor = '';
                            }, 1000);

                            // Cerrar dropdown despu√©s de un breve delay
                            setTimeout(() => {
                                const descripcionDropdown = document.getElementById('descripcionDropdown');
                                if (descripcionDropdown) {
                                    gsap.to(descripcionDropdown, {
                                        duration: 0.3,
                                        opacity: 0,
                                        scale: 0.95,
                                        y: -10,
                                        ease: "power2.inOut",
                                        onComplete: function () {
                                            descripcionDropdown.style.display = 'none';
                                        }
                                    });
                                    isDescripcionOpen = false;
                                }
                            }, 500);
                        } else {
                            // Mostrar mensaje de error m√°s amigable
                            const searchDescripcionBtn = e.target;
                            const originalText = searchDescripcionBtn.textContent;
                            searchDescripcionBtn.textContent = '‚ö† Escribe o selecciona';
                            searchDescripcionBtn.style.backgroundColor = '#dc3545';

                            setTimeout(() => {
                                searchDescripcionBtn.textContent = originalText;
                                searchDescripcionBtn.style.backgroundColor = '';
                            }, 2000);
                        }
                    }
                });

                // ========== EGRESOS CALENDAR EVENT LISTENERS ==========

                // Egresos calendar navigation
                if (e.target && e.target.id === 'egresosPrevYear') {
                    egresosCurrentDate.setFullYear(egresosCurrentDate.getFullYear() - 1);
                    generateEgresosCalendar();
                }
                if (e.target && e.target.id === 'egresosNextYear') {
                    egresosCurrentDate.setFullYear(egresosCurrentDate.getFullYear() + 1);
                    generateEgresosCalendar();
                }
                if (e.target && e.target.id === 'egresosPrevMonth') {
                    egresosCurrentDate.setMonth(egresosCurrentDate.getMonth() - 1);
                    generateEgresosCalendar();
                }
                if (e.target && e.target.id === 'egresosNextMonth') {
                    egresosCurrentDate.setMonth(egresosCurrentDate.getMonth() + 1);
                    generateEgresosCalendar();
                }

                // Egresos calendar buttons
                if (e.target && e.target.id === 'egresosCancelDate') {
                    const egresosCalendarDropdown = document.getElementById('egresosCalendarDropdown');
                    if (egresosCalendarDropdown) {
                        gsap.to(egresosCalendarDropdown, {
                            duration: 0.3,
                            opacity: 0,
                            scale: 0.95,
                            y: -10,
                            ease: "power2.inOut",
                            onComplete: function () {
                                egresosCalendarDropdown.style.display = 'none';
                            }
                        });
                        isEgresosCalendarOpen = false;
                    }
                }

                if (e.target && e.target.id === 'egresosSearchDate') {
                    console.log('üîç Click en bot√≥n buscar egresos detectado');
                    console.log('üìÖ Fecha seleccionada en egresos:', egresosSelectedDate);
                    console.log('üîç Elemento clickeado:', e.target);
                    console.log('üîç ID del elemento:', e.target.id);

                    if (egresosSelectedDate) {
                        console.log('‚úÖ Fecha v√°lida encontrada, procediendo con b√∫squeda...');
                        console.log('üîç B√∫squeda por fecha de egresos:', egresosSelectedDate);

                        // Mostrar feedback visual "Buscando..."
                        const searchEgresosBtn = e.target;
                        const originalText = searchEgresosBtn.textContent;
                        searchEgresosBtn.textContent = '‚úì Buscando...';
                        searchEgresosBtn.style.backgroundColor = '#1e5a0f';

                        setTimeout(() => {
                            searchEgresosBtn.textContent = originalText;
                            searchEgresosBtn.style.backgroundColor = '';
                        }, 1000);

                        // Cerrar calendario despu√©s de un breve delay
                        setTimeout(() => {
                            const egresosCalendarDropdown = document.getElementById('egresosCalendarDropdown');
                            if (egresosCalendarDropdown) {
                                gsap.to(egresosCalendarDropdown, {
                                    duration: 0.3,
                                    opacity: 0,
                                    scale: 0.95,
                                    y: -10,
                                    ease: "power2.inOut",
                                    onComplete: function () {
                                        egresosCalendarDropdown.style.display = 'none';
                                    }
                                });
                                isEgresosCalendarOpen = false;
                            }
                        }, 500);
                    } else {
                        console.log('‚ö†Ô∏è No hay fecha seleccionada, mostrando error...');
                        // Mostrar mensaje de error m√°s amigable
                        const searchEgresosBtn = e.target;
                        const originalText = searchEgresosBtn.textContent;
                        searchEgresosBtn.textContent = '‚ö† Selecciona una fecha';
                        searchEgresosBtn.style.backgroundColor = '#dc3545';

                        setTimeout(() => {
                            searchEgresosBtn.textContent = originalText;
                            searchEgresosBtn.style.backgroundColor = '';
                        }, 2000);
                    }
                }

                // ========== EGRESOS MONTO EVENT LISTENERS ==========

                // Egresos monto selection
                if (e.target && e.target.classList.contains('monto-option') && e.target.closest('#egresosMontoDropdown')) {
                    console.log('üí∞ Click en opci√≥n de monto de egresos detectado');
                    console.log('üîç Elemento clickeado:', e.target);
                    console.log('üîç Data-range del elemento:', e.target.getAttribute('data-range'));

                    // Remover selecci√≥n anterior
                    document.querySelectorAll('#egresosMontoDropdown .monto-option.selected').forEach(option => {
                        option.classList.remove('selected');
                    });

                    // Agregar selecci√≥n actual
                    e.target.classList.add('selected');
                    egresosSelectedMontoRange = e.target.getAttribute('data-range');

                    console.log('üí∞ Rango de monto de egresos seleccionado:', egresosSelectedMontoRange);
                    console.log('üí∞ Variable egresosSelectedMontoRange actualizada a:', egresosSelectedMontoRange);
                    console.log('üîÑ Actualizando bot√≥n de buscar...');

                    // Actualizar bot√≥n de buscar inmediatamente
                    updateEgresosMontoButtonStates();

                    // Verificar que la variable se mantenga despu√©s de la actualizaci√≥n
                    setTimeout(() => {
                        console.log('üîç Verificaci√≥n post-actualizaci√≥n - egresosSelectedMontoRange:', egresosSelectedMontoRange);
                    }, 100);
                }

                // ========== EGRESOS DESCRIPCI√ìN EVENT LISTENERS ==========

                // Egresos descripci√≥n selection
                if (e.target && e.target.classList.contains('descripcion-option') && e.target.closest('#egresosDescripcionDropdown')) {
                    console.log('üìù Click en opci√≥n de descripci√≥n de egresos detectado');

                    // Remover selecci√≥n anterior
                    document.querySelectorAll('#egresosDescripcionDropdown .descripcion-option.selected').forEach(option => {
                        option.classList.remove('selected');
                    });

                    // Agregar selecci√≥n actual
                    e.target.classList.add('selected');
                    egresosSelectedDescripcion = e.target.getAttribute('data-descripcion');

                    // Limpiar input personalizado
                    const egresosDescripcionInput = document.getElementById('egresosDescripcionInput');
                    if (egresosDescripcionInput) {
                        egresosDescripcionInput.value = '';
                        egresosCustomDescripcion = '';
                    }

                    console.log('üìù Descripci√≥n de egresos seleccionada:', egresosSelectedDescripcion);
                    console.log('üîÑ Actualizando bot√≥n de buscar...');

                    // Actualizar bot√≥n de buscar inmediatamente
                    updateEgresosDescripcionButtonStates();
                }

                // Egresos descripci√≥n input
                if (e.target && e.target.id === 'egresosDescripcionInput') {
                    const input = e.target;

                    // Limpiar selecci√≥n de opciones
                    document.querySelectorAll('#egresosDescripcionDropdown .descripcion-option.selected').forEach(option => {
                        option.classList.remove('selected');
                    });
                    egresosSelectedDescripcion = null;

                    // Actualizar descripci√≥n personalizada
                    egresosCustomDescripcion = input.value;

                    console.log('üìù Descripci√≥n personalizada de egresos:', egresosCustomDescripcion);
                    console.log('üîÑ Actualizando bot√≥n de buscar...');

                    // Actualizar bot√≥n de buscar inmediatamente
                    updateEgresosDescripcionButtonStates();
                }

            }, 500);
        });
    </script>

</body>

</html>